#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
% Hebrew does not work unless I use this. 
\usepackage{culmus}

\usepackage{fancyhdr}
\fancyhf{}               % Clear fancy header/footer
\fancyhead[C]{
\begin{otherlanguage}{English}
Technion, Faculty of Industrial Engineering and Management
\end{otherlanguage}
}   
\fancyfoot[C]{\thepage}  % Page number in Right footer
\makeatletter
\let\ps@plain\ps@fancy   % Plain page style = fancy page style
\makeatother
\newref{fig}{refcmd={\hyperref[#1]{Figure \ref{#1}}}}
\newref{tab}{refcmd={\hyperref[#1]{Table \ref{#1}}}}
\newref{eq}{refcmd={\hyperref[#1]{Eq. (\ref{#1})}}}
\newref{alg}{refcmd={\hyperref[#1]{Algorithem (\ref{#1})}}}
\end_preamble
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package auto
\inputencoding utf8
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\float_placement H
\paperfontsize 12
\spacing other 1.5
\use_hyperref true
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen false
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder false
\pdf_colorlinks false
\pdf_backref false
\pdf_pdfusetitle true
\papersize default
\use_geometry true
\use_package amsmath 2
\use_package amssymb 2
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2cm
\topmargin 2cm
\rightmargin 2cm
\bottommargin 2cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip smallskip
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle fancy
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Introduction to Casual Inference - 097400
\begin_inset Newline newline
\end_inset

Winter 2021 - Project Report
\end_layout

\begin_layout Author
Asaf Gendler 301727715 Shalev Shaer 305252520
\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section

\bar under
Introduction:
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "Bates_2020"
literal "false"

\end_inset


\end_layout

\begin_layout Section

\bar under
Problem Formulation:
\end_layout

\begin_layout Subsection
Data-set Structure:
\end_layout

\begin_layout Standard
To understand the problem, methods and the improvement we suggest, we first
 have to formulate the problem mathematically.
 To do so, we need to have a little bit of understanding of concepts in
 genetics, that will help us better understand out data-sets.
 The human cells have 
\begin_inset Formula $36$
\end_inset

 DNA strands organized into 
\begin_inset Formula $23$
\end_inset

 chromosomes pairs, In each chromosome pair, one strand is inherited from
 the father and one strand is inherited from the mother.
 Each one of this strands is called a haplotype.
 The haplotype consists of a chain of links called single-nucleotide polymorphis
ms or SNP.
 The reason their are called so is that they can appear in the population
 in one of two possible ways, therefore they can be encoded as binary variables
 which can get the values of 
\begin_inset Formula $0$
\end_inset

 or 
\begin_inset Formula $1$
\end_inset

.
 See 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Hapoltypes_and_SNP"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for visualization of the described above.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figure1.png
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Hapoltypes_and_SNP"

\end_inset

An illustration of haplotypes and SNPs.
 The chromosome pair consists of two DNA strands.
 Each strand is called an haplotype.
 Each single link in the haplotype is called a SNP and can take one of two
 forms in the population.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
We consider a data-set of 
\begin_inset Formula $n$
\end_inset

 father-mother-offspring trios, where for each one of them we have two haplotype
s encodings of 
\begin_inset Formula $p$
\end_inset

 SNP's values, all the haplotypes are of the same chromosome.
 The haplotypes of the father will be denoted as 
\begin_inset Formula $F^{a}$
\end_inset

 and 
\begin_inset Formula $F^{b}$
\end_inset

, the mother's as 
\begin_inset Formula $M^{a}$
\end_inset

 and 
\begin_inset Formula $M^{b}$
\end_inset

 , and the offspring, which is our test subject as 
\begin_inset Formula $X^{f}$
\end_inset

 and 
\begin_inset Formula $X^{m}$
\end_inset

 as they are inherited from the father and mother respectively.
 The data-set structure is thus as follows:
\begin_inset Formula 
\[
\begin{array}{cc}
\begin{cases}
F^{a}=\left(\begin{array}{cccccc}
| & | &  &  &  & |\\
F_{1}^{a} & F_{2}^{a} & . & . & . & F_{p}^{a}\\
| & | &  &  &  & |
\end{array}\right)\in\left\{ 0,1\right\} ^{nxp}\\
 & \Longrightarrow\\
F^{b}=\left(\begin{array}{cccccc}
| & | &  &  &  & |\\
F_{1}^{b} & F_{2}^{b} & . & . & . & F_{p}^{b}\\
| & | &  &  &  & |
\end{array}\right)\in\left\{ 0,1\right\} ^{nxp}
\end{cases} & X^{f}=\left(\begin{array}{cccccc}
| & | &  &  &  & |\\
X_{1}^{f} & X_{2}^{f} & . & . & . & X_{p}^{f}\\
| & | &  &  &  & |
\end{array}\right)\in\left\{ 0,1\right\} ^{nxp}\\
\begin{cases}
M^{a}=\left(\begin{array}{cccccc}
| & | &  &  &  & |\\
M_{1}^{a} & M_{2}^{a} & . & . & . & M_{p}^{a}\\
| & | &  &  &  & |
\end{array}\right)\in\left\{ 0,1\right\} ^{nxp}\\
 & \Longrightarrow\\
M^{b}=\left(\begin{array}{cccccc}
| & | &  &  &  & |\\
M_{1}^{b} & F_{2}^{b} & . & . & . & F_{p}^{b}\\
| & | &  &  &  & |
\end{array}\right)\in\left\{ 0,1\right\} ^{nxp}
\end{cases} & X^{m}=\left(\begin{array}{cccccc}
| & | &  &  &  & |\\
X_{1}^{m} & X_{2}^{m} & . & . & . & X_{p}^{m}\\
| & | &  &  &  & |
\end{array}\right)\in\left\{ 0,1\right\} ^{nxp}
\end{array}
\]

\end_inset


\end_layout

\begin_layout Standard
For easier notation we will denote the offsprings' matrix as 
\begin_inset Formula $X=X^{f}+X^{m}$
\end_inset

.
 The 
\begin_inset Formula $i$
\end_inset

-th row of this matrix 
\begin_inset Formula $X^{\left(i\right)}$
\end_inset

 corresponds to the haplotypes of the 
\begin_inset Formula $i$
\end_inset

-th subject, and the 
\begin_inset Formula $j$
\end_inset

-th column 
\begin_inset Formula $X_{j}$
\end_inset

 corresponds to the 
\begin_inset Formula $j$
\end_inset

-th SNP of all the subjects.
 We also denote 
\begin_inset Formula $A=\left\{ F^{a},F^{b},M^{a},M^{b}\right\} $
\end_inset

 as the set of all parents haplotypes (A as a short for ancestors).
\end_layout

\begin_layout Subsection
The goal
\end_layout

\begin_layout Standard
Our main goal is to establish causality in the Trio design, in a rigorous
 statistical sense.
 more precisely, we want to examine a causal connection between a SNP 
\begin_inset Formula $X_{j}$
\end_inset

 or a group of SNPs 
\begin_inset Formula $X_{C}=\left\{ X_{j}:j\in C\right\} $
\end_inset

 to some phenomena or outcome 
\begin_inset Formula $Y$
\end_inset

.
 Differently from the main casual problems that we saw in the course, where
 the goal was to calculate the ATE or the ATT, our problem is only a binary
 problem that tries to answer the question whether or not there is a causal
 connection, and doesn't try to estimate it's value.
 Mathematically we formulate the problem as a hypothesis testing problem
 as follows: given the examined SNP 
\begin_inset Formula $X_{j}$
\end_inset

 and some outcome 
\begin_inset Formula $Y$
\end_inset

 we want to test the null hypothesis:
\begin_inset Formula 
\begin{align}
H_{0}:X_{j} & \perp\!\!\!\perp Y\label{eq:1}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
which means that this SNP and the outcome are statistically independent.
 Rejecting the null hypothesis will deduce that there is a statistical connectio
n between the two, however, as we saw in the course statistical dependency
 and high correlation does not necessarily indicate a causal effect.
 For example, take 
\begin_inset Formula $Z$
\end_inset

 to be some unobserved external variable that has a high casual effect on
 the outcome 
\begin_inset Formula $Y$
\end_inset

.
 Consider the case where the data-set contains two groups of populations,
 one group which tends to have the SNP 
\begin_inset Formula $X_{j}$
\end_inset

 with a value of 
\begin_inset Formula $1$
\end_inset

 and also tends to practice 
\begin_inset Formula $Z$
\end_inset

, and the other group which tends to have the SNP 
\begin_inset Formula $X_{j}$
\end_inset

 with a value of 
\begin_inset Formula $0$
\end_inset

 and also doesn't tend to practice 
\begin_inset Formula $Z$
\end_inset

.
 As a result, when testing the null hypothesis we suggested, we will probably
 reject it and find a statistical connection between 
\begin_inset Formula $X_{j}$
\end_inset

 and 
\begin_inset Formula $Y$
\end_inset

, however, this relation was caused due the the correlation between 
\begin_inset Formula $X_{j}$
\end_inset

 and 
\begin_inset Formula $Z$
\end_inset

, and the effect of 
\begin_inset Formula $Z$
\end_inset

 on 
\begin_inset Formula $Y$
\end_inset

, and no due to a causal effect of 
\begin_inset Formula $X_{j}$
\end_inset

 on 
\begin_inset Formula $Y$
\end_inset

.
 
\begin_inset Formula $Z$
\end_inset

 is in fact a hidden confounder as we saw in the course, and the causal
 graph will look like in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Hidden_Confounder"
plural "false"
caps "false"
noprefix "false"

\end_inset

, which doesn't let us identify a causal effect of 
\begin_inset Formula $X_{j}$
\end_inset

 on 
\begin_inset Formula $Y$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figure2.png
	width 25text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Hidden_Confounder"

\end_inset

A possible causal graph.
 In this scenario we can't identify a causal connection between 
\begin_inset Formula $X_{j}$
\end_inset

 and 
\begin_inset Formula $Y$
\end_inset

 without observing 
\begin_inset Formula $Z$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
As a result if we want to examine a causal effect, we need to do something
 smarter, as suggested in the next topic.
\end_layout

\begin_layout Subsection
Identifying Causality
\begin_inset CommandInset label
LatexCommand label
name "subsec:Identifying-Causality"

\end_inset


\end_layout

\begin_layout Standard
To solve the problem of some external unobserved hidden confounders, we
 need to address the recombination process of an offspring haplotypes from
 his parents haplotypes.
 Remember that the offspring has two haplotypes, one of them is a recombination
 of the two haplotypes of the father and the other is a recombination of
 the two haplotypes of the mother, an example for such a recombination can
 be seen in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Recombination_Process"
plural "false"
caps "false"
noprefix "false"

\end_inset

 .
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figure4.png
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Recombination_Process"

\end_inset

One offspring's haplotype is a recombination of the father's haplotypes
 and the other is a recombination of the mother's haplotypes
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The crucial point for understanding, is that this recombination is a completely
 random process, with a known generation mechanism that can be simulated.
 Basically it means that given the haplotypes of the parents, we can stochastica
lly model the generation process of the offspring haplotypes, simulate it,
 sample from it, etc.
 Mathematically it means that the distribution of 
\begin_inset Formula $X_{j}$
\end_inset

 and actually all the SNPs is known given the parents haplotypes, which
 we denoted as the set 
\begin_inset Formula $A$
\end_inset

.
 From considerations of space, we won't fully detail the mathematical model
 of the recombination process, it is detailed in the paper and was implemented
 by us in python.
\end_layout

\begin_layout Standard
The main advantage of the randomness of the offspring's haplotypes recombination
 process is that if we go back to the scenario depicted in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Hidden_Confounder"
plural "false"
caps "false"
noprefix "false"

\end_inset

, the causal graph should actually be depicted as in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Back_Door"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figure3.png
	width 25text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Back_Door"

\end_inset

The true casual graph, 
\begin_inset Formula $X_{j}$
\end_inset

 is effected by 
\begin_inset Formula $Z$
\end_inset

 only through 
\begin_inset Formula $A$
\end_inset

 and thus 
\begin_inset Formula $A$
\end_inset

 satisfies the backdoor criterion
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
What we see is that the external hidden confounder 
\begin_inset Formula $Z$
\end_inset

 has a causal effect on 
\begin_inset Formula $X_{j}$
\end_inset

 only through 
\begin_inset Formula $A$
\end_inset

, basically it means that any external hidden confounder can effect the
 parents haplotypes, but if we have observed them, then from there one the
 offspring haplotypes can be effected only by them and not by any unobserved
 hidden confounder.
 Understanding this, then instead of checking hypothesis 
\begin_inset CommandInset ref
LatexCommand formatted
reference "eq:1"
plural "false"
caps "false"
noprefix "false"

\end_inset

, we will instead check the following null hypothesis:
\begin_inset Formula 
\begin{equation}
H_{0}:X_{j}\perp\!\!\!\perp Y|A\label{eq:2}
\end{equation}

\end_inset

The main theorem of the paper shows that checking 
\begin_inset CommandInset ref
LatexCommand formatted
reference "eq:2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 is equivalent for checking the following:
\begin_inset Formula 
\begin{equation}
H_{0}:X_{j}\perp\!\!\!\perp Y|A,Z\label{eq:3}
\end{equation}

\end_inset

where 
\begin_inset Formula $Z$
\end_inset

 is any external unobserved variable.
 What we see here is basically the backdoor adjustment criterion which we
 saw in the course, the set 
\begin_inset Formula $A$
\end_inset

 satisfies the backdoor criteria, corresponding to the causal graph in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Back_Door"
plural "false"
caps "false"
noprefix "false"

\end_inset

, and thus conditioning on him is enough to identify causality between 
\begin_inset Formula $X_{j}$
\end_inset

 and 
\begin_inset Formula $Y$
\end_inset

.
 
\end_layout

\begin_layout Subsection
limitations
\end_layout

\begin_layout Standard
From what we have showed in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:Identifying-Causality"
plural "false"
caps "false"
noprefix "false"

\end_inset

, we can deduce that if we have found a strong statistical connection between
 
\begin_inset Formula $X_{j}$
\end_inset

 and 
\begin_inset Formula $Y$
\end_inset

 conditioned on 
\begin_inset Formula $A$
\end_inset

, which basically means that we will reject the null hypothesis 
\begin_inset CommandInset ref
LatexCommand formatted
reference "eq:2"
plural "false"
caps "false"
noprefix "false"

\end_inset

, is has to mean that there is a causal effect between 
\begin_inset Formula $X_{j}$
\end_inset

 and 
\begin_inset Formula $Y$
\end_inset

.
 However, this is not precisely the case.
 We have said that the recombination process of the offspring's haplotypes
 is random conditioned on the parents, which is true, but the SNPs themselves
 for example, 
\begin_inset Formula $X_{j}$
\end_inset

 and 
\begin_inset Formula $X_{k}$
\end_inset

 are not independent on each other given the parents haplotypes 
\begin_inset Formula $A$
\end_inset

.
 This is due to the way the recombination occurs which we haven't discussed
 in details here but in short, the recombination tends to keep large chains
 of SNPs from the parents' haplotype, together in the offspring's haplotype.
 These dependencies can make the causal graph look like at 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:SNP_dependencies"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for example.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figure5.png
	width 25text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:SNP_dependencies"

\end_inset

SNPs can be dependent on each other given the parent haplotypes 
\begin_inset Formula $A$
\end_inset

, thus 
\begin_inset Formula $A$
\end_inset

 itself doesn't satisfy the backdoor criterion anymore.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Analogously to our insight on the external counfounder 
\begin_inset Formula $Z$
\end_inset

, if we reject hypothesis 
\begin_inset CommandInset ref
LatexCommand formatted
reference "eq:2"
plural "false"
caps "false"
noprefix "false"

\end_inset

, it could either mean that 
\begin_inset Formula $X_{j}$
\end_inset

 indeed has an effect on 
\begin_inset Formula $Y$
\end_inset

 or that some other SNP actually caused the effect.
 To deal with this issue, we will have to condition on all the other SNPs
 there we are not checking, and define a new null hypothesis:
\begin_inset Formula 
\begin{equation}
H_{0}:X_{j}\perp\!\!\!\perp Y|A,X_{-j}\label{eq:4}
\end{equation}

\end_inset

where 
\begin_inset Formula $X_{-j}$
\end_inset

 denotes all other SNPs besides 
\begin_inset Formula $X_{j}$
\end_inset

.
 Still, Hypothesis 
\begin_inset CommandInset ref
LatexCommand formatted
reference "eq:2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 that from now on we will call the global casual null hypothesis, has its
 benefits.
 This hypothesis testing still helps us find whether or not there is some
 SNP on the pair of haplotypes that might effect the outcome 
\begin_inset Formula $Y$
\end_inset

.
 If we reject the global null, it doesn't necessarily means that 
\begin_inset Formula $X_{j}$
\end_inset

 has an effect on 
\begin_inset Formula $Y$
\end_inset

 but it does mean that some SNP or a group of SNPs on the pair of haplotypes
 does have an effect.
 On the other hand, accepting the global null means not only that 
\begin_inset Formula $X_{j}$
\end_inset

 doesn't have an effect but that actually all the SNPs on that haplotypes
 pair doesn't have an effect.
 This is why we call this hypothesis the global null, as it helps us to
 identify global causal effect between a pair of haplotypes and an outcome
 
\begin_inset Formula $Y$
\end_inset

.
 If we want to further localize which SNP or group of SNPs actually caused
 the effect, we will need to use 
\begin_inset CommandInset ref
LatexCommand formatted
reference "eq:4"
plural "false"
caps "false"
noprefix "false"

\end_inset

 which is therefore called the local casual null hypothesis.
 To check the local null we will have to know the distribution of 
\begin_inset Formula $X_{j}$
\end_inset

 conditioned on his parents haplotypes, and all the other SNPs.
 This is possible, and the paper details how to do so, however, because
 this makes the generation procedure much more complicated, and because
 our improvement can be cooperated with both the global null and the local
 null, we will deal with only the global null from now on.
\end_layout

\begin_layout Standard
We also remark that a few environmental factors of the parents can affect
 the inheritance process, such as the exposure of a parent to radiation,
 which changes the distribution of the offspring by increasing the frequency
 of mutations.
 This factors will of course break the backdoor criteria satisfied by 
\begin_inset Formula $A$
\end_inset

, however, those factors are very rare and can be neglectable most of the
 times.
\end_layout

\begin_layout Section

\bar under
Methods for solution:
\end_layout

\begin_layout Standard
Now that we have understood which null hypothesis we want to check, let's
 discuss about the method to check it.
 We are going to check the global null hypothesis in the most generalized
 way, that is, examine the influence of a group of SNPs as follows:
\begin_inset Formula 
\begin{align}
H_{0} & :X_{C}\perp\!\!\!\perp Y|A\nonumber \\
 & X_{C}=\left\{ X_{j}:j\in C\right\} \label{eq:5}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
In order to do so, the paper suggests to use a version of the conditional
 randomization test suggested in 
\begin_inset CommandInset citation
LatexCommand cite
key "Cand_s_2018"
literal "false"

\end_inset

 and calls it the Digital Twin Test (DTT).
 We will not proof the validity of the test but only explain how in works.
 This test is useful when you want to check a conditional hypothesis and
 you know how so sample from the conditional probability, which is exactly
 our case.
 We will describe the test in a more machine learning approach for better
 understanding of our improvement.
 First we take the data and split in into training and test sets.
 Then we fit some model between all the features, which are the SNPs in
 our case, 
\begin_inset Formula $X_{C}$
\end_inset

 and 
\begin_inset Formula $X_{-C}$
\end_inset

 to the outcome 
\begin_inset Formula $Y$
\end_inset

.
 We then calculate some error statistic 
\begin_inset Formula $T$
\end_inset

 of the model on the test data, for example the MSE, and denote the value
 as 
\begin_inset Formula $t^{*}$
\end_inset

.
 Notice that this statistic 
\begin_inset Formula $T$
\end_inset

 can in fact be any statistic we want (even doesn't have to integrate machine
 learning methods) and the validity of the test will still hold.
 Next, using our knowledge of the offspring's haplotypes given the parents
 haplotypes, we generate for each pair of parents in the test set 
\begin_inset Formula $K$
\end_inset

 digital offsprings (They are like digital twins of the original offspring
 hence the name of the test), effectively creating 
\begin_inset Formula $K$
\end_inset

 new test sets, and compute our statistic 
\begin_inset Formula $T$
\end_inset

 on each one of them, each result denoted as 
\begin_inset Formula $t_{j}$
\end_inset

.
 The critical point here is that when we create the digital offsprings,
 we only take the part 
\begin_inset Formula $\widetilde{X}_{C}$
\end_inset

 that we want to examine from it, and put in instead of the original 
\begin_inset Formula $X_{C}$
\end_inset

 while leaving the other SNPs intact.
 At the end of the process we will have 
\begin_inset Formula $K$
\end_inset

 values 
\begin_inset Formula $\left\{ t_{1},...,t_{k}\right\} $
\end_inset

 and the original value 
\begin_inset Formula $t^{*}$
\end_inset

.
 All that is left to do is calculate the relative position of 
\begin_inset Formula $t^{*}$
\end_inset

 among 
\begin_inset Formula $\left\{ t_{1},...,t_{k}\right\} $
\end_inset

 values (for example
\begin_inset Formula $\left(0.1\right)$
\end_inset

), this will be our p-value for the test (the test is rejected for any 
\begin_inset Formula $\alpha$
\end_inset

 that is higher than the p-value).
 The reasoning behind this test, is that if the group 
\begin_inset Formula $X_{C}$
\end_inset

 indeed has a statistical association with 
\begin_inset Formula $Y$
\end_inset

 (and our model is well fitted), than by generating new digital offsprings
 with different values of 
\begin_inset Formula $X_{C}$
\end_inset

, the outcome values predicted by the model will change dramatically, hence
 the original error statistic will be relative small compared to the others
 and we will get a small p-value (which is s strong evidence for rejecting).
 On the contrary, if the value of 
\begin_inset Formula $X_{C}$
\end_inset

 doesn't have any influence on the outcome, we expect the model to predict
 more or less the same outcome values just as before, hence 
\begin_inset Formula $t^{*}$
\end_inset

 shouldn't be small compared to 
\begin_inset Formula $\left\{ t_{1},...,t_{k}\right\} $
\end_inset

 and the p-value will be high, thus we will accept the null hypothesis.
 a summary of the algorithm is presented in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "alg:The-Digital-Twin"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Itemize
\paragraph_spacing single
\noindent

\family roman
Input: data 
\begin_inset Formula $X$
\end_inset

, outcome 
\begin_inset Formula $Y$
\end_inset

, parental data 
\begin_inset Formula $A$
\end_inset

, region 
\begin_inset Formula $C$
\end_inset

, number of iterations 
\begin_inset Formula $K$
\end_inset


\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Split
\series default
 the data into train and test sets, and fit a model 
\begin_inset Formula $f\left(X_{C},X_{-C}\right)$
\end_inset

 between the SNPs and the outcome on the train data.
\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Compute
\series default
 the error test statistic on the test data:
\begin_inset Formula 
\[
t^{*}=T\left(f\left(X_{C},X_{-C}\right),Y\right)
\]

\end_inset


\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
for
\series default
 
\begin_inset Formula $k=1,...,K$
\end_inset

 
\series bold
Do
\series default
:
\end_layout

\begin_deeper
\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Sample
\series default
 the digital twins 
\begin_inset Formula $\widetilde{X}$
\end_inset

 based on the parents using the known 
\begin_inset Formula $P\left(X|A\right)$
\end_inset

 and put 
\begin_inset Formula $\widetilde{X}_{C}$
\end_inset

 instead of the original 
\begin_inset Formula $X_{C}$
\end_inset

.
\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Compute
\series default
 the error test statistic using the digital twins:
\begin_inset Formula 
\[
t_{k}=T\left(f\left(\widetilde{X}_{C},X_{-C}\right),Y\right)
\]

\end_inset


\family default
\series bold
end
\end_layout

\end_deeper
\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Compute
\series default
 the quantile of the true statistic 
\begin_inset Formula $t^{*}$
\end_inset

 among the digital twin statistics 
\begin_inset Formula $\left\{ t_{1},...,t_{k}\right\} $
\end_inset


\end_layout

\begin_layout LyX-Code
\paragraph_spacing single
\noindent

\family roman
\begin_inset Formula 
\[
p_{val}=\frac{1+\sum_{i=1}^{K}\mathbb{I}\left\{ t_{i}\leq t^{*}\right\} }{K+1}
\]

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "alg:The-Digital-Twin"

\end_inset

The Digital Twin Test
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section

\bar under
Extension
\end_layout

\begin_layout Subsection
general
\end_layout

\begin_layout Standard
Conditional Randomized Test (CRT) methods, such as the one we have described
 in the Digital Twin Test are now common in order to test hypothesis.
 CRT methods sample from a conditional distribution (in our context it was
 
\begin_inset Formula $P\left(X_{C}|A\right)$
\end_inset

 ) to create a "fake" sample 
\begin_inset Formula $\widetilde{X}_{C}$
\end_inset

, and use the fake sample 
\series bold
only
\series default
 in the test (as a counter sample).
 We suggest to involve the fake data 
\begin_inset Formula $\widetilde{X}_{C}$
\end_inset

 in the learning process as well (we can get infinite samples of 
\begin_inset Formula $\widetilde{X}_{C}$
\end_inset

 as we sample from a known distribution) in order to increase the power
 of the test or to decrease the false detection rate.
 In this section we will combine 
\begin_inset Formula $\widetilde{X}_{C}$
\end_inset

 in a binary classifier, and examine whether the CRT give good results or
 not.
\end_layout

\begin_layout Subsection
The proposed method
\end_layout

\begin_layout Standard
Our proposed method is as follow: First, we create the fake data 
\begin_inset Formula $\widetilde{X}$
\end_inset

 by sampling the desired region 
\begin_inset Formula $C$
\end_inset

 from 
\begin_inset Formula $P\left(X|A\right)$
\end_inset

 and substitute it with the desired region in 
\begin_inset Formula $X$
\end_inset

 .
 Then we concatenate the outcome 
\begin_inset Formula $Y$
\end_inset

 once with 
\begin_inset Formula $X$
\end_inset

 and once with 
\begin_inset Formula $\widetilde{X}$
\end_inset

 , thus creating real data and fake data.
 We add labels to each one of this data sets, the real data gets the label
 
\begin_inset Formula $"1"$
\end_inset

 and the fake data the label 
\begin_inset Formula $"0"$
\end_inset

.
 We then train a binary classifier with the both the real and fake data
 that tries to extinguish who is real and who is not.
 The 
\begin_inset Formula $T$
\end_inset

 statistic in the CRT, which liked said before can be any statistic, will
 now be the sum of the probabilities of getting 
\begin_inset Formula $"1"$
\end_inset

 in the output of the classifier.
 The full algorithm is described below.
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Itemize
\paragraph_spacing single
\noindent

\family roman
Input: true data 
\begin_inset Formula $X$
\end_inset

, outcome 
\begin_inset Formula $Y$
\end_inset

, parental data 
\begin_inset Formula $A$
\end_inset

, binary classifier , region 
\begin_inset Formula $C$
\end_inset

, number of iterations 
\begin_inset Formula $K$
\end_inset


\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Create
\series default
 
\begin_inset Formula $\widetilde{X}$
\end_inset

 by sampling the digital twins like in DTT 
\begin_inset Formula $\widetilde{X}=\left(\widetilde{X}_{C},X_{-C}\right)$
\end_inset


\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Create
\series default
 the training data by concatenating 
\begin_inset Formula $Y$
\end_inset

 to 
\begin_inset Formula $X$
\end_inset

 and to 
\begin_inset Formula $\widetilde{X}$
\end_inset

, and add the label 
\begin_inset Formula $"1"$
\end_inset

 to 
\begin_inset Formula $X$
\end_inset

 and 
\begin_inset Formula $"0"$
\end_inset

 to 
\begin_inset Formula $\widetilde{X}$
\end_inset


\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Fit
\series default
 the classifier with both 
\begin_inset Formula $\left(X,Y,1\right)$
\end_inset

 and 
\begin_inset Formula $\left(\widetilde{X},Y,0\right)$
\end_inset

 as one training set
\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Compute
\series default
 the test statistic on the test data: 
\begin_inset Formula 
\[
t^{*}=-\sum_{i\in Test}P\left(classifier(x_{i},y_{i})=1\right)
\]

\end_inset


\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
for
\series default
 
\begin_inset Formula $k=1,...,K$
\end_inset

 
\series bold
Do
\series default
:
\end_layout

\begin_deeper
\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Sample
\series default
 the digital twins 
\begin_inset Formula $\widetilde{X}$
\end_inset

 based on the parents using the known 
\begin_inset Formula $P\left(X|A\right)$
\end_inset

 and put 
\begin_inset Formula $\widetilde{X}_{C}$
\end_inset

 instead of the original 
\begin_inset Formula $X_{C}$
\end_inset

.
\end_layout

\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Compute
\series default
 the test statistic using the digital twins:
\begin_inset Formula 
\[
t_{k}=-\sum_{i\in Test}P\left(classifier(\tilde{x}_{i},y_{i})=1\right)
\]

\end_inset


\end_layout

\begin_layout Description
\paragraph_spacing single
\noindent

\family roman
\series bold
end
\end_layout

\end_deeper
\begin_layout Enumerate
\paragraph_spacing single
\noindent

\family roman
\series bold
Compute
\series default
 the quantile of the true statistic 
\begin_inset Formula $t^{*}$
\end_inset

 among the digital twin statistics
\begin_inset Formula $\left\{ t_{1},...,t_{k}\right\} $
\end_inset


\end_layout

\begin_layout LyX-Code
\paragraph_spacing single
\noindent

\family roman
\begin_inset Formula 
\[
p_{val}=\frac{1+\sum_{i=1}^{K}\mathbb{I}\left\{ t_{i}\leq t^{*}\right\} }{K+1}
\]

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "alg:The-Digital-Twin-extended"

\end_inset

The Digital Twin Test with binary classifier
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The reasoning behind our new proposal is as follows.
 If the set of SNPs 
\begin_inset Formula $X_{C}$
\end_inset

 has a large influence on the outcome 
\begin_inset Formula $Y$
\end_inset

, the we expect our classifier to train well, and be able to distinguish
 well between real examples and the fake ones.
 In this case, when we will generate the digital twins on the test set,
 the classifier will tend to give higher probabilities to the original data
 over the generated one.
 On the contrary, if the SNPs doesn't influence 
\begin_inset Formula $Y$
\end_inset

 at all, than our trained classifier will act poorly, not able to distinguishing
 between real and fake, hence the probabilities it will give to the digital
 twins during test will be more or less the same to the probabilities on
 the original set.
\end_layout

\begin_layout Section

\bar under
Simulations and Results:
\end_layout

\begin_layout Standard
First, let us describe the settings.
 We create a synthetic population of 
\begin_inset Formula $n=250$
\end_inset

 parent-child trios and generate an outcome coming from a sparse regression
 model 
\begin_inset Formula $Y=\beta X+v$
\end_inset

 where 
\begin_inset Formula $v\sim N(0,1)$
\end_inset

.
 We use 
\begin_inset Formula $p=100,150$
\end_inset

 SNPs from a chromosome with a width of 
\begin_inset Formula $50$
\end_inset

 Mb, and 
\begin_inset Formula $\beta$
\end_inset

 is sparse and has only 
\begin_inset Formula $10$
\end_inset

 non zeros entries of equal strength.
 We used four different signal strength 
\begin_inset Formula $c=1,2,3,4$
\end_inset

, and for every value of 
\begin_inset Formula $c$
\end_inset

 we used the suggested algorithm 
\begin_inset Formula $20$
\end_inset

 times.
 We choose Quadratic Discriminant Analysis (QDA) as our classifier.
 These experiments demonstrate a situation of a causal region, therefore
 we expect low p-values.
 We plot a plot-box for the extracted p-values for every setting as can
 be seen in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:p100"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:p150"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 As we can see, our method behave as expected - the higher the signal strength
 the smaller the p-value and the narrower the standard deviation of the
 p-values.
 Furthermore, the more SNPs there are (the greater the 
\begin_inset Formula $p$
\end_inset

), the higher the p-values and wider the standard deviation.
 The original DTT on this setting always results in a minimal close to zero
 p-value so we didn't plot it as it does not bring more information than
 this mention.
 For a final experiment we produce the outcome 
\begin_inset Formula $Y$
\end_inset

 from a random distribution 
\begin_inset Formula $N(0,1)$
\end_inset

, and ran the suggested algorithm with QDA classifier.
 The results are in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:noisy_output"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 We can see that for a noisy outcome, unrelated to the SNPs, the p-values
 are high and with high standard deviation, as expected.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename p100.png
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:p100"

\end_inset

A box plot for 
\begin_inset Formula $p=100$
\end_inset

 and 
\begin_inset Formula $k=10$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename p150.png
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:p150"

\end_inset

A box plot for 
\begin_inset Formula $p=150$
\end_inset

 and 
\begin_inset Formula $k=10$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename noisy_outcome.png
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:noisy_output"

\end_inset

A box plot for 
\begin_inset Formula $p=100$
\end_inset

 , 
\begin_inset Formula $p=150$
\end_inset

 and a noisy output 
\begin_inset Formula $Y$
\end_inset

 unrelated to the SNPs
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section

\bar under
Conclusion and Future Work:
\end_layout

\begin_layout Standard
Our method does not outperform the DTT as described above, but it does work
 well and behave as expected.
 The main goal of this project was to examine whether our idea to use 
\begin_inset Formula $\widetilde{X}$
\end_inset

 in the training process make sense or not, and it seems that it does.
 For future work one can consider involve 
\begin_inset Formula $\widetilde{X}$
\end_inset

 in more complex methods (e.g Neural Networks) and check whether it increases
 the power and 
\backslash
 or decrease the false detection rate.
 
\end_layout

\begin_layout Standard
It is important to note that although we didn't test our method with the
 local causal null hypothesis, we expect similar result as the framework
 is the same and only the conditional sampling procedure changes.
 Another aspect that both us and the paper didn't investigate is the use
 of multiple hypothesis testing methods, such as FDR, to unite examining
 of different SNPs regions into one more powerful test.
 Of course that our method can be extended to this filed as well, as it
 is generic.
\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
btprint "btPrintCited"
bibfiles "IEEEabrv,IEEEexample,IEEEfull,Candes,main_paper"
options "IEEEtran"

\end_inset


\end_layout

\end_body
\end_document
